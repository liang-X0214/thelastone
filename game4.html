<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é—ºå¡¾å¸ˆå†é™©</title>
    <style>
		@font-face { font-family: 'MyFont'; src: url('img/yezigongchangxiaoshitou.ttf') format('truetype'); }
        /* æ–°å¢ï¼šæ¸¸æˆä»‹ç»å¼¹çª—æ ·å¼ */
        .intro-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
        }
        
        .intro-modal.hidden {
            display: none;
        }
        
        .intro-content {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 3px solid #FFD700;
            overflow-y: auto;
            position: relative;
            color: #fff;
        }
        
        .intro-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #FF4500;
        }
        
        .intro-title {
            font-size: 2.2rem;
            color: #FFD700;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .intro-subtitle {
            font-size: 1.2rem;
            color: #FF6347;
            font-style: italic;
        }
        
        .intro-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border-left: 4px solid #4A90E2;
            backdrop-filter: blur(5px);
        }
        
        .section-title {
            font-size: 1.6rem;
            color: #FFD700;
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #FF6347;
            font-size: 1.8rem;
        }
        
        .intro-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #e6e6e6;
            text-align: justify;
            margin-bottom: 10px;
        }
        
        .controls-guide {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .control-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .control-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 69, 0, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.8rem;
            color: #FFD700;
            border: 2px solid #FF6347;
        }
        
        .control-details {
            flex: 1;
        }
        
        .control-action {
            font-size: 1.3rem;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 3px;
        }
        
        .control-desc {
            font-size: 1rem;
            color: #b3b3b3;
        }
        
        .game-rules {
            background: rgba(74, 144, 226, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #32CD32;
        }
        
        .rule-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .rule-item i {
            color: #32CD32;
            margin-right: 10px;
            margin-top: 3px;
        }
        
        .rule-text {
            font-size: 1rem;
            color: #e6e6e6;
            line-height: 1.5;
        }
        
        .intro-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .start-game-btn {
            background: linear-gradient(145deg, #FF4500, #FF6347);
            color: white;
            border: none;
            padding: 18px 45px;
            font-size: 1.4rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 0 auto 15px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(255, 69, 0, 0.4);
            min-width: 250px;
        }
        
        .start-game-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 69, 0, 0.6);
        }
        
        .skip-btn {
            background: transparent;
            border: none;
            color: #4A90E2;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: underline;
            padding: 8px 16px;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: white;
        }
        
        body {
			font-family: MyFont;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 500px;
            max-height: 900px;
            overflow: hidden;
            background: #000;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background-color: #87CEEB;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            text-align: center;
            padding: 20px;
            z-index: 100;
        }
        
        .hidden {
            display: none !important;
        }
        
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 1.5rem;
            color: #FFD700;
        }
        
        h2 {
            font-size: 2.2rem;
            margin-bottom: 1.2rem;
            color: #FFD700;
        }
        
        p {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        button {
            background: linear-gradient(145deg, #FF4500, #FF6347);
            color: white;
            border: none;
            padding: 16px 32px;
            margin: 12px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            min-width: 200px;
        }
        
        .return-btn {
            background: linear-gradient(145deg, #4A90E2, #357ABD);
        }
        
        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid #FFD700;
            z-index: 50;
        }
        
        #targetScore {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.4rem;
            font-weight: bold;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 12px;
            border-radius: 15px;
            border: 2px solid #32CD32;
            z-index: 50;
        }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 1.2rem;
            background: rgba(0, 0, 0, 0.6);
            padding: 12px;
            z-index: 50;
        }
        
        #jumpArea {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            z-index: 30;
        }
    </style>
</head>
<body>
    <!-- æ–°å¢ï¼šæ¸¸æˆä»‹ç»å¼¹çª— -->
    <div id="introModal" class="intro-modal">
        <div class="intro-content">
            <div class="intro-header">
                <h1 class="intro-title">é—ºå¡¾å¸ˆå†é™©</h1>
                <p class="intro-subtitle">ç©¿è¶Šæ—¶ç©ºï¼Œä½“éªŒå¤ä»£é—ºå¡¾å¸ˆçš„å¥”è·‘å†’é™©</p>
            </div>
            
            <div class="intro-section">
                <h2 class="section-title"><i class="fas fa-book"></i> å¤ä»£é—ºå¡¾å¸ˆç®€ä»‹</h2>
                <p class="intro-text">
                    é—ºå¡¾å¸ˆï¼Œåˆç§°"å¥³å¸ˆ"æˆ–"é—ºé˜æ•™å¸ˆ"ï¼Œæ˜¯å¤ä»£ä¸“é—¨åœ¨é—ºé˜ä¸­æ•™æˆè´µæ—å¥³å­è¯—ä¹¦ç¤¼ä»ªã€ç´æ£‹ä¹¦ç”»çš„å¥³æ€§æ•™å¸ˆã€‚å¥¹ä»¬å¤§å¤šå‡ºèº«ä¹¦é¦™é—¨ç¬¬ï¼Œæˆ–æ˜¯æ‰ååœ¨å¤–çš„é—ºé˜æ‰å¥³ï¼Œç”šè‡³æ˜¯è¾å®˜å½’éšçš„å¥³å„’ã€‚
                </p>
                <p class="intro-text">
                    è¿™äº›æ‰æƒ…å“è¶Šçš„å¥³æ€§ä¸ä»…è¦æ•™ã€Šå¥³è¯«ã€‹ã€Šåˆ—å¥³ä¼ ã€‹ç­‰ç»å…¸ï¼Œè¿˜è¦æŒ‡å¯¼å¥³çº¢åˆºç»£ã€æ’èŠ±ç„šé¦™ã€èŒ¶é“ç¤¼ä»ªï¼Œå ªç§°å¤ä»£çš„"å…¨èƒ½å¥³å­ç´ å…»æ•™ç»ƒ"ã€‚å¥¹ä»¬åœ¨ç§å¯†çš„é—ºæˆ¿ã€æš–é˜ä¸­æˆè¯¾ï¼Œæˆä¸ºè¿æ¥å¥³æ€§æ–‡åŒ–ä¸çŸ¥è¯†çš„é‡è¦çº½å¸¦ã€‚
                </p>
                <p class="intro-text">
                    è®¸å¤šé—ºå¡¾å¸ˆè¿˜ä¼šå°†è‡ªå·±çš„è¯—ä½œã€å¿ƒå¾—ä¼ æˆç»™å­¦ç”Ÿï¼Œè¿™äº›å†…å®¹åæ¥æˆä¸ºå¤ä»£å¥³æ€§æ–‡å­¦çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ‚„æ‚„æ‰“ç ´äº†"å¥³å­æ— æ‰ä¾¿æ˜¯å¾·"çš„ä¼ ç»Ÿè§‚å¿µã€‚
                </p>
            </div>
            
            <div class="intro-section">
                <h2 class="section-title"><i class="fas fa-gamepad"></i> æ¸¸æˆæ“ä½œæŒ‡å—</h2>
                
                <div class="controls-guide">
                    <div class="control-item">
                        <div class="control-icon">
                            <i class="fas fa-hand-point-up"></i>
                        </div>
                        <div class="control-details">
                            <div class="control-action">ç‚¹å‡»/è§¦æ‘¸å±å¹•</div>
                            <div class="control-desc">è·³è·ƒ - è®©é—ºå¡¾å¸ˆè·³è¿‡éšœç¢ç‰©</div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-icon">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                        <div class="control-details">
                            <div class="control-action">å‘ä¸Šæ»‘åŠ¨</div>
                            <div class="control-desc">é•¿æŒ‰å¯å®ç°æ›´é«˜è·³è·ƒ</div>
                        </div>
                    </div>
                    
                    <div class="control-item">
                        <div class="control-icon">
                            <i class="fas fa-keyboard"></i>
                        </div>
                        <div class="control-details">
                            <div class="control-action">ç©ºæ ¼é”®/æ–¹å‘é”®ä¸Š</div>
                            <div class="control-desc">é”®ç›˜æ§åˆ¶è·³è·ƒ</div>
                        </div>
                    </div>
                </div>
                
                <div class="game-rules">
                    <div class="rule-item">
                        <i class="fas fa-running"></i>
                        <div class="rule-text">é—ºå¡¾å¸ˆä¼šè‡ªåŠ¨å‘å‰å¥”è·‘</div>
                    </div>
                    <div class="rule-item">
                        <i class="fas fa-hurdle"></i>
                        <div class="rule-text">æˆåŠŸèº²é¿ä¸€ä¸ªéšœç¢ç‰©å¾—10åˆ†</div>
                    </div>
                    <div class="rule-item">
                        <i class="fas fa-bullseye"></i>
                        <div class="rule-text">è¾¾åˆ°100åˆ†å³å¯é€šå…³æˆåŠŸ</div>
                    </div>
                    <div class="rule-item">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="rule-text">ç¢°åˆ°éšœç¢ç‰©æ¸¸æˆç«‹å³ç»“æŸ</div>
                    </div>
                    <div class="rule-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <div class="rule-text">åˆ†æ•°è¶Šé«˜ï¼Œæ¸¸æˆé€Ÿåº¦è¶Šå¿«</div>
                    </div>
                </div>
            </div>
            
            <div class="intro-footer">
                <button id="startGameBtn" class="start-game-btn">
                    <i class="fas fa-play-circle"></i> å¼€å§‹å†’é™©ä¹‹æ—…
                </button>
                <button id="skipIntroBtn" class="skip-btn">
                    è·³è¿‡ä»‹ç»ï¼Œç›´æ¥å¼€å§‹æ¸¸æˆ
                </button>
            </div>
        </div>
    </div>
    
    <!-- åŸæœ‰æ¸¸æˆå®¹å™¨ -->
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="score">å¾—åˆ†: 0</div>
        <div id="targetScore">ç›®æ ‡: 100åˆ†</div>
        <div id="instructions">â¬†ï¸ å‘ä¸Šæ»‘åŠ¨æˆ–ç‚¹å‡»å±å¹•è·³è·ƒ</div>
        <div id="jumpArea"></div>
        
        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="startScreen" class="screen">
            <h1>é—ºå¡¾å¸ˆå†é™©</h1>
            <p>ğŸƒâ€ï¸ å¸®åŠ©é—ºå¡¾å¸ˆèº²é¿éšœç¢ç‰©</p>
            <p>â¬†ï¸ å‘ä¸Šæ»‘åŠ¨æˆ–ç‚¹å‡»å±å¹•è·³è·ƒ</p>
            <p>ğŸ¯ è¾¾åˆ°100åˆ†å³å¯è·èƒœï¼</p>
            <p>ğŸ’¡ èº²è¿‡ä¸€ä¸ªéšœç¢å¾—10åˆ†</p>
            <button id="startButton">å¼€å§‹å†’é™©</button>
        </div>
        
        <!-- å¤±è´¥ç•Œé¢ -->
        <div id="failScreen" class="screen hidden">
            <h2>æ¸¸æˆç»“æŸ</h2>
            <p>ğŸ˜¢ ä½ æ²¡èƒ½è¾¾åˆ°ç›®æ ‡åˆ†æ•°</p>
            <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore" style="color:#FFD700;font-size:1.8rem;">0</span> åˆ†</p>
            <div>
                <button id="restartButton">é‡æ–°å¼€å§‹</button>
                <button id="returnToIndexFromFail" class="return-btn">è¿”å›ä¸»ç•Œé¢</button>
            </div>
        </div>
        
        <!-- çŸ¥è¯†ä»‹ç»ç•Œé¢ -->
        <div id="knowledgeScreen" class="screen hidden">
            <h2>ğŸ‰ æ­å–œé€šå…³ï¼</h2>
            <div id="knowledge">
                <h3>ğŸ® å…³äºé—ºå¡¾å¸ˆçš„æœ‰è¶£çŸ¥è¯†</h3>
                <p>èº«ä»½åå·®èŒï¼šå¥¹ä»¬å¤§å¤šä¸æ˜¯åˆ»æ¿çš„è€å­¦ç©¶ï¼Œä¸å°‘æ˜¯æ‰ååœ¨å¤–çš„é—ºé˜æ‰å¥³ã€è¾å®˜å½’éšçš„å¥³å„’ï¼Œç”šè‡³æ˜¯ç²¾é€šç´æ£‹ä¹¦ç”»çš„ "æ–‡è‰ºå§å§"ï¼Œæ—¢èƒ½æ•™ã€Šå¥³è¯«ã€‹ï¼Œä¹Ÿèƒ½é™ªå°å§ä»¬åŸè¯—ä½œå¯¹ã€‚</p>
                <p>æ•™å­¦å†…å®¹è¶…ä¸°å¯Œï¼šä¸åªæ˜¯æ•™è¯†å­—è¯»ç»ï¼Œè¿˜è¦æ‰‹æŠŠæ‰‹æ•™å¥³çº¢åˆºç»£ã€æ’èŠ±ç„šé¦™ã€èŒ¶é“ç¤¼ä»ªï¼Œå ªç§°å¤ä»£ "å…¨èƒ½å¥³å­ç´ å…»æ•™ç»ƒ"ï¼Œç›®æ ‡æ˜¯åŸ¹å…»çŸ¥ä¹¦è¾¾ç†çš„å¤§å®¶é—ºç§€ã€‚</p>
                <p>ä¸Šè¯¾åœ°ç‚¹å¾ˆç§å¯†ï¼šæˆè¯¾ä»ä¸åœ¨å®—æ—ç¥ å ‚è¿™ç±»å…¬å…±åœºåˆï¼Œè€Œæ˜¯åœ¨å°å§çš„é—ºæˆ¿ã€åèŠ±å›­çš„æš–é˜é‡Œï¼Œè®²ç©¶ "å†…é—±æˆè¯¾"ï¼Œå¤–äººè½»æ˜“è§ä¸åˆ°ã€‚</p>
                <p>éšè—çš„ "æ–‡åŒ–çº½å¸¦"ï¼šå¾ˆå¤šé—ºå¡¾å¸ˆä¼šæŠŠè‡ªå·±çš„è¯—ä½œã€å¿ƒå¾—ä¼ ç»™å­¦ç”Ÿï¼Œè¿™äº›å†…å®¹åæ¥æˆäº†å¤ä»£å¥³æ€§æ–‡å­¦çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ‚„æ‚„æ‰“ç ´äº† "å¥³å­æ— æ‰ä¾¿æ˜¯å¾·" çš„æ—§è§‚å¿µã€‚</p>
            </div>
            <button id="continueButton">ç»§ç»­</button>
        </div>
        
        <!-- æ¸¸æˆç»“æŸèœå• -->
        <div id="gameOverScreen" class="screen hidden">
            <h2>ğŸŠ æ¸¸æˆé€šå…³ï¼</h2>
            <p>æ­å–œä½ æˆåŠŸå®Œæˆç¬¬ä¸€å…³ï¼</p>
            <div>
                <button id="gameRestartButton">é‡æ–°æ¸¸æˆ</button>
                <button id="quizButton">å¼€å§‹æµ‹éªŒ</button>
                <button id="returnToIndexFromSuccess" class="return-btn">è¿”å›ä¸»ç•Œé¢</button>
            </div>
        </div>
    </div>

    <!-- Font Awesomeå›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        // æ–°å¢ï¼šå¼¹çª—æ§åˆ¶
        const introModal = document.getElementById('introModal');
        const startGameBtn = document.getElementById('startGameBtn');
        const skipIntroBtn = document.getElementById('skipIntroBtn');
        
        // æ˜¾ç¤ºå¼¹çª—ï¼ˆé¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤ºï¼‰
        window.addEventListener('load', () => {
            introModal.classList.remove('hidden');
        });
        
        // å¼€å§‹æ¸¸æˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        startGameBtn.addEventListener('click', () => {
            introModal.classList.add('hidden');
            // æ˜¾ç¤ºåŸæ¥çš„å¼€å§‹ç•Œé¢
            document.getElementById('startScreen').classList.remove('hidden');
        });
        
        // è·³è¿‡ä»‹ç»æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        skipIntroBtn.addEventListener('click', () => {
            introModal.classList.add('hidden');
            // æ˜¾ç¤ºåŸæ¥çš„å¼€å§‹ç•Œé¢
            document.getElementById('startScreen').classList.remove('hidden');
        });
        
        // æ¸¸æˆå˜é‡
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // æ¸¸æˆçŠ¶æ€
        let gameState = 'start';
        let score = 0;
        const TARGET_SCORE = 100;
        
        // å›¾ç‰‡èµ„æº
        const images = {
            player: new Image(),
            obstacle: new Image(),
            cloud: new Image(),
            mountain: new Image(),
            tree: new Image(),
            ground: new Image()
        };
        
        // å›¾ç‰‡è·¯å¾„
        images.player.src = 'img/xiaoren.png';
        images.obstacle.src = 'img/scale.png';
        images.cloud.src = 'img/cloud.png';
        images.mountain.src = 'img/hill.png';
        images.tree.src = 'img/tree.png';
        images.ground.src = 'img/ground.png';
        
        // æ¸¸æˆå¯¹è±¡
        let player = {
            x: 80,
            y: 0,
            width: 72,
            height: 144,
            velocityY: 0,
            jumping: false,
            groundY: 0
        };
        
        let obstacles = [];
        let mountains = [];
        let trees = [];
        let clouds = [];
        let lastObstacleTime = 0;
        let gameSpeed = 3;
        
        // æ¸¸æˆè®¾ç½®
        const GRAVITY = 0.4;
        const JUMP_FORCE = -15;
        const INITIAL_GAME_SPEED = 4;
        const OBSTACLE_MIN_INTERVAL = 1500;
        const OBSTACLE_MAX_INTERVAL = 2500;
        
        // === æ–°å¢ï¼šè¿”å›ä¸»é¡µé¢çš„å‡½æ•° ===
        function goBackToMain() {
            // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­è¿è¡Œ
            if (window.parent && window.parent.closeGame) {
                // è°ƒç”¨çˆ¶é¡µé¢çš„å…³é—­å‡½æ•°
                window.parent.closeGame();
            } else {
                // å¦‚æœæ²¡æœ‰çˆ¶é¡µé¢å‡½æ•°ï¼Œå›é€€åˆ°åŸæ¥çš„è·³è½¬æ–¹å¼
                window.location.href = "index.html";
            }
        }
        
        // åˆå§‹åŒ–Canvaså¤§å°
        function initCanvas() {
            const container = document.getElementById('gameContainer');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            player.groundY = canvas.height - 100 - player.height;
            player.y = player.groundY;
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            score = 0;
            document.getElementById('score').textContent = `å¾—åˆ†: ${score}`;
            player.y = player.groundY;
            player.velocityY = 0;
            player.jumping = false;
            obstacles = [];
            mountains = [];
            trees = [];
            clouds = [];
            gameSpeed = INITIAL_GAME_SPEED;
            lastObstacleTime = Date.now();
            gameState = 'playing';
            
            // åˆå§‹åˆ›å»ºèƒŒæ™¯å…ƒç´ 
            for (let i = 0; i < 3; i++) createMountain(canvas.width + i * 300);
            for (let i = 0; i < 5; i++) createTree(canvas.width + i * 180);
            for (let i = 0; i < 3; i++) createCloud(canvas.width + i * 300);
            
            // éšè—æ‰€æœ‰ç•Œé¢
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // æ·»åŠ åˆå§‹éšœç¢ç‰©
            setTimeout(() => createObstacle(), 1000);
        }
        
        // åˆ›å»ºå±±ï¼ˆä»å³è¾¹ç•Œï¼‰
        function createMountain(x) {
            mountains.push({
                x: x,
                y: canvas.height - 410,
                width: 500,
                height: 390
            });
        }
        
        // åˆ›å»ºæ ‘ï¼ˆä»å³è¾¹ç•Œï¼‰
        function createTree(x) {
            trees.push({
                x: x,
                y: canvas.height - 300,
                size: 200,
				width: 250,
				height:200
            });
        }
        
        // åˆ›å»ºäº‘ï¼ˆä»å³è¾¹ç•Œï¼‰
        function createCloud(x) {
            clouds.push({
                x: x,
                y: 60 + Math.random() * 100,
                size: 100 + Math.random() * 20
            });
        }
        
        // ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            // å¤©ç©º
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, '#87CEEB');
            skyGradient.addColorStop(1, '#0a83ed');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç§»åŠ¨å¹¶ç»˜åˆ¶èƒŒæ™¯å…ƒç´ 
            moveAndDrawBackground();
            
            // åœ°é¢
            const groundPattern = ctx.createPattern(images.ground, 'repeat');
            ctx.fillStyle = groundPattern;
            ctx.fillRect(0, canvas.height - 100, canvas.width, 100);
        }
        
        // ç§»åŠ¨å¹¶ç»˜åˆ¶èƒŒæ™¯å…ƒç´ 
        function moveAndDrawBackground() {
            // å±±
            for (let i = mountains.length - 1; i >= 0; i--) {
                const m = mountains[i];
                m.x -= gameSpeed;
                
                if (m.x + m.width < 0) {
                    mountains.splice(i, 1);
                    createMountain(canvas.width);
                } else if (images.mountain.complete) {
                    ctx.drawImage(images.mountain, m.x, m.y, m.width, m.height);
                }
            }
            
            // æ ‘
            for (let i = trees.length - 1; i >= 0; i--) {
                const t = trees[i];
                t.x -= gameSpeed;
                
                if (t.x + t.size < 0) {
                    trees.splice(i, 1);
                    createTree(canvas.width);
                } else if (images.tree.complete) {
                    ctx.drawImage(images.tree, t.x, t.y, t.size, t.size);
                }
            }
            
            // äº‘
            for (let i = clouds.length - 1; i >= 0; i--) {
                const c = clouds[i];
                c.x -= gameSpeed * 0.7;
                
                if (c.x + c.size < 0) {
                    clouds.splice(i, 1);
                    createCloud(canvas.width);
                } else if (images.cloud.complete) {
                    ctx.drawImage(images.cloud, c.x, c.y, c.size, c.size);
                }
            }
        }
        
        // ç»˜åˆ¶ç©å®¶
        function drawPlayer() {
            if (images.player.complete) {
                ctx.drawImage(images.player, player.x, player.y, player.width, player.height);
            } else {
                ctx.fillStyle = '#E52521';
                ctx.fillRect(player.x, player.y, player.width, player.height);
            }
        }
        
        // ç»˜åˆ¶éšœç¢ç‰©
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                if (images.obstacle.complete) {
                    ctx.drawImage(images.obstacle, obstacle.x, obstacle.y, 150, 120);
                } else {
                    ctx.fillStyle = '#8B4513';
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                }
            });
        }
        
        // æ›´æ–°ç©å®¶ä½ç½®
        function updatePlayer() {
            player.velocityY += GRAVITY;
            player.y += player.velocityY;
            
            if (player.y > player.groundY) {
                player.y = player.groundY;
                player.velocityY = 0;
                player.jumping = false;
            }
        }
        
        // æ›´æ–°éšœç¢ç‰©
        function updateObstacles() {
            obstacles.forEach(obstacle => {
                obstacle.x -= gameSpeed;
            });
            
            obstacles = obstacles.filter(obstacle => obstacle.x > -obstacle.width);
            
            if (Date.now() - lastObstacleTime > getObstacleInterval() && obstacles.length < 4) {
                createObstacle();
                lastObstacleTime = Date.now();
            }
        }
        
        // è·å–éšœç¢ç‰©ç”Ÿæˆé—´éš”
        function getObstacleInterval() {
            const base = OBSTACLE_MAX_INTERVAL - (OBSTACLE_MAX_INTERVAL - OBSTACLE_MIN_INTERVAL) * (score / TARGET_SCORE);
            return Math.max(OBSTACLE_MIN_INTERVAL, base);
        }
        
        // åˆ›å»ºéšœç¢ç‰©
        function createObstacle() {
            const obstacleHeight = 72 + Math.random() * 18;
            const obstacleWidth = 63;
            obstacles.push({
                x: canvas.width,
                y: canvas.height - 100 - obstacleHeight,
                width: obstacleWidth,
                height: obstacleHeight,
                passed: false
            });
        }
        
        // æ£€æµ‹ç¢°æ’
        function checkCollision() {
            for (let obstacle of obstacles) {
                if (
                    player.x+15 < obstacle.x + obstacle.width &&
                    player.x + player.width-15 > obstacle.x &&
                    player.y +15< obstacle.y + obstacle.height &&
                    player.y + player.height-15 > obstacle.y
                ) {
                    return true;
                }
            }
            return false;
        }
        
        // æ£€æŸ¥æ˜¯å¦é€šè¿‡éšœç¢ç‰©
        function checkPassedObstacles() {
            obstacles.forEach(obstacle => {
                if (!obstacle.passed && obstacle.x + obstacle.width < player.x) {
                    obstacle.passed = true;
                    score += 10;
                    document.getElementById('score').textContent = `å¾—åˆ†: ${score}`;
                    
                    // éšåˆ†æ•°å¢åŠ æ¸¸æˆé€Ÿåº¦
                    gameSpeed = INITIAL_GAME_SPEED + (score / TARGET_SCORE);
                }
            });
        }
        
        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (gameState === 'playing') {
                updateGame();
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // æ›´æ–°æ¸¸æˆ
        function updateGame() {
            drawBackground();
            drawPlayer();
            drawObstacles();
            
            updatePlayer();
            updateObstacles();
            
            if (checkCollision()) {
                gameOver();
                return;
            }
            
            checkPassedObstacles();
            
            if (score >= TARGET_SCORE) {
                showKnowledgeScreen();
            }
        }
        
        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameState = 'failed';
            document.getElementById('finalScore').textContent = score;
            document.getElementById('failScreen').classList.remove('hidden');
        }
        
        // æ˜¾ç¤ºçŸ¥è¯†å±å¹•
        function showKnowledgeScreen() {
            gameState = 'knowledge';
            document.getElementById('knowledgeScreen').classList.remove('hidden');
        }
        
        // è¿”å›ä¸»ç•Œé¢
        function returnToIndexPage() {
            // === ä¿®æ”¹ï¼šä½¿ç”¨æ–°çš„è¿”å›å‡½æ•° ===
            goBackToMain();
        }
        
        // äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            document.getElementById('startButton').addEventListener('click', initGame);
            document.getElementById('restartButton').addEventListener('click', initGame);
            document.getElementById('gameRestartButton').addEventListener('click', initGame);
            
            document.getElementById('continueButton').addEventListener('click', () => {
                document.getElementById('knowledgeScreen').classList.add('hidden');
                document.getElementById('gameOverScreen').classList.remove('hidden');
                gameState = 'gameOver';
            });
            
            document.getElementById('quizButton').addEventListener('click', () => {
                window.location.href = "question4.html";
            });
            
            // === ä¿®æ”¹ï¼šè¿”å›ä¸»ç•Œé¢æŒ‰é’®ï¼ˆå¤±è´¥ç•Œé¢ï¼‰===
            document.getElementById('returnToIndexFromFail').addEventListener('click', function() {
                goBackToMain();
            });
            
            // === ä¿®æ”¹ï¼šè¿”å›ä¸»ç•Œé¢æŒ‰é’®ï¼ˆæˆåŠŸç•Œé¢ï¼‰===
            document.getElementById('returnToIndexFromSuccess').addEventListener('click', function() {
                goBackToMain();
            });
            
            // è·³è·ƒæ§åˆ¶
            const jumpArea = document.getElementById('jumpArea');
            jumpArea.addEventListener('touchstart', handleJump);
            jumpArea.addEventListener('click', handleJump);
            canvas.addEventListener('touchstart', handleJump);
            canvas.addEventListener('click', handleJump);
            
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', (e) => {
                if (gameState !== 'playing') return;
                if ((e.code === 'Space' || e.code === 'ArrowUp') && !player.jumping) {
                    player.velocityY = JUMP_FORCE;
                    player.jumping = true;
                }
            });
        }
        
        // å¤„ç†è·³è·ƒ
        function handleJump(e) {
            if (gameState !== 'playing') return;
            if (!player.jumping) {
                player.velocityY = JUMP_FORCE;
                player.jumping = true;
            }
            e.preventDefault();
        }
        
        // åˆå§‹åŒ–
        window.addEventListener('resize', initCanvas);
        window.addEventListener('orientationchange', () => {
            setTimeout(initCanvas, 100);
        });
        
        function init() {
            initCanvas();
            initEventListeners();
            gameLoop();
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>